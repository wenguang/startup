**两台虚拟器间的连通** 

cient.c、server.c在不同的centos虚拟机环境也

同一虚拟机可以连接成功，不同虚拟器连接异常：

server用环路ip bind，在启动firewall时(service firewalld restart)，cient的connect函数抛出：no route to host，在停止firewall时，client的connect函数抛出：connect refused

当client的sockfd设置为O_NONBLOCK后，errno显示EINPROGRESS：Operation now in progress异常

```
EINPROGRESS

    The socket is nonblocking and the connection cannot be completed
    immediately.  It is possible to select(2) or poll(2) for completion by
    selecting the socket for writing.  After select(2) indicates
    writability, use getsockopt(2) to read the SO_ERROR option at level
    SOL_SOCKET to determine whether connect() completed successfully
    (SO_ERROR is zero) or unsuccessfully (SO_ERROR is one of the usual
    error codes listed here, explaining the reason for the failure).
```

一般是连接上后才把sockfd设置为O_NONBLOCK



**正解** 

https://www.centos.org/forums/viewtopic.php?t=57032 这里提到

> It is only listening to port xxx on localhost, not your lan interface.

原因：用sockaddr_in构建一个地址，指定ip为127.0.0.1，它只是一个环路地址，只在在同一虚拟机上连接成功。

应该用getifadds函数获取网卡信息，获得enp0s3上为AF_INET的地址。

虚拟机上ifconfig的信息如下：

```shell
enp0s3: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.1.104  netmask 255.255.255.0  broadcast 192.168.1.255
        inet6 fe80::9734:ffea:1940:3c93  prefixlen 64  scopeid 0x20<link>
        ether 08:00:27:1e:b2:7a  txqueuelen 1000  (Ethernet)
        RX packets 106341  bytes 105557442 (100.6 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 53965  bytes 4743821 (4.5 MiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1  (Local Loopback)
        RX packets 76  bytes 5736 (5.6 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 76  bytes 5736 (5.6 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```



**netstat -ant 查看网络状态** 

同一虚拟机连接上后的网络状态：

用ctl-c终止client



**g++在linux上编译，inet_addr函数不起作用** 